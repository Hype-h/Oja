<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Sign In - Oja Marketplace</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="logo">
      <img src="./public/logo.png" alt="Oja Logo" class="logo-img">
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="products.html">Browse</a></li>
    </ul>
    <div class="nav-right">
      <button class="btn btn-secondary" onclick="window.location.href='index.html'">Back</button>
    </div>
  </nav>

  <!-- Alerts -->
  <div class="alert alert-success hidden" id="successAlert"></div>
  <div class="alert alert-error hidden" id="errorAlert"></div>

  <!-- Auth Container -->
  <div class="container padded">
    <div class="auth-container">
      <h2 class="auth-title">Admin Sign In</h2>
      <p class="auth-subtitle">Administrator access only</p>
      
      <form onsubmit="adminLogin(event)">
        <div class="form-group">
          <label for="loginEmail">Admin Email</label>
          <input type="email" id="loginEmail" required placeholder="Enter admin email">
        </div>
        <div class="form-group">
          <label for="loginPassword">Admin Password</label>
          <input type="password" id="loginPassword" required minlength="6" placeholder="Enter admin password">
        </div>
        <button type="submit" class="btn btn-primary full-width mt-1">Sign In as Admin</button>
      </form>

      <div class="auth-link">
        <a href="customer-auth.html">Customer Login</a> | 
        <a href="vendor-auth.html">Vendor Login</a>
      </div>

      <div style="margin-top: 2rem; padding: 1rem; background: #f0f9ff; border-radius: 0.5rem; border-left: 4px solid #3b82f6;">
        <p style="margin: 0; font-size: 0.875rem; color: #1e40af;">
          <strong>Admin Access Required:</strong> Only authorized administrators can access this area. 
          Contact system administrator for admin credentials.
        </p>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-functions-compat.js"></script>

  <script>
    // ====== FIREBASE CONFIGURATION ======
    const firebaseConfig = {
    apiKey: "AIzaSyALSSw0-d0F2-Zkj5aXVN1ip7FcMCouy8Q",
    authDomain: "oja-place01.firebaseapp.com",
    projectId: "oja-place01",
    storageBucket: "oja-place01.firebasestorage.app",
    messagingSenderId: "543711721814",
    appId: "1:543711721814:web:6fafe8a7cf1db4b3493ef7"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Show alert
    function showAlert(msg, type = "success") {
      const id = type === "success" ? "successAlert" : "errorAlert";
      const el = document.getElementById(id);
      if (el) {
        el.textContent = msg;
        el.classList.remove("hidden");
        setTimeout(() => el.classList.add("hidden"), 3000);
      }
    }

    // Admin Login
    async function adminLogin(e) {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      if (!email || !password) {
        showAlert("Please fill in all fields", "error");
        return;
      }

      try {
        const result = await auth.signInWithEmailAndPassword(email, password);
        
        // Check if admin role
        const userDoc = await db.collection("users").doc(result.user.uid).get();
        if (userDoc.exists && userDoc.data().role === "admin") {
          showAlert("Admin access granted!");
          setTimeout(() => window.location.href = "admin-dashboard.html", 1000);
        } else {
          showAlert("Invalid admin credentials. Access denied.", "error");
          await auth.signOut();
        }
      } catch (error) {
        console.error("Login error:", error);
        showAlert(error.message, "error");
      }
    }

    // Check if already logged in as admin
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        const userDoc = await db.collection("users").doc(user.uid).get();
        if (userDoc.exists && userDoc.data().role === "admin") {
          window.location.href = "./admin-dashboard.html";
        }
      }
    });

    // Create first admin account (development only)
    async function createFirstAdmin() {
      const adminEmail = "admin@oja.com";
      const adminPassword = "admin123456";
      
      try {
        const result = await auth.createUserWithEmailAndPassword(adminEmail, adminPassword);
        await db.collection("users").doc(result.user.uid).set({
          name: "System Admin",
          email: adminEmail,
          role: "admin",
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log("âœ… Admin account created:", adminEmail);
      } catch (error) {
        console.log("Admin account may already exist");
      }
    }

    // Uncomment to create first admin (run once only)
    // setTimeout(createFirstAdmin, 2000);
  </script>
</body>
</html>